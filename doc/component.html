<!DOCTYPE html><html lang="en"><head><title>component</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="component"><meta name="groc-project-path" content="src/component.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/component.coffee</div></div><div id="document"><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> date 2016-01-23 16:46:42, author vfasky <a href="&#x6d;&#97;&#x69;&#x6c;&#x74;&#111;&#x3a;&#x76;&#102;&#x61;&#115;&#107;&#121;&#64;&#x67;&#109;&#97;&#x69;&#x6c;&#46;&#99;&#111;&#109;">&#x76;&#102;&#x61;&#115;&#107;&#121;&#64;&#x67;&#109;&#97;&#x69;&#x6c;&#46;&#99;&#111;&#109;</a>, and link <a href="http://vfasky.com">http://vfasky.com</a></span></p>
<p>组件</p></div></div><div class="code"><div class="wrapper"><span class="hljs-string">'use strict'</span>
EventEmitter = <span class="hljs-built_in">require</span> <span class="hljs-string">'./eventEmitter'</span>
Template = <span class="hljs-built_in">require</span> <span class="hljs-string">'./template'</span>
util = <span class="hljs-built_in">require</span> <span class="hljs-string">'./util'</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Component</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EventEmitter</span></span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> el 真实的 DOM and virtualEl 虚拟 el</span></p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@el</span>, <span class="hljs-property">@virtualEl</span> = <span class="hljs-literal">null</span>)</span>-&gt;</span>
        <span class="hljs-property">@init</span>()
        <span class="hljs-property">@watch</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>初始化</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">init</span>: <span class="hljs-function">-&gt;</span>

    <span class="hljs-attribute">watch</span>: <span class="hljs-function">-&gt;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>渲染</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">render</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@virtualDomDefine</span>, scope = {}, doneOrAsync = <span class="hljs-literal">true</span>)</span>-&gt;</span>
        <span class="hljs-keyword">if</span> !<span class="hljs-property">@template</span>
            <span class="hljs-property">@template</span> = <span class="hljs-keyword">new</span> Template()
            <span class="hljs-property">@template</span>._proxy = @
            <span class="hljs-property">@template</span>.once <span class="hljs-string">'rendered'</span>, <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@refs</span>)</span>=&gt;</span> <span class="hljs-property">@mount</span>()
            <span class="hljs-property">@template</span>.<span class="hljs-literal">on</span> <span class="hljs-string">'rendered'</span>, <span class="hljs-function"><span class="hljs-params">(refs)</span>=&gt;</span> <span class="hljs-property">@emit</span> <span class="hljs-string">'rendered'</span>, refs

        <span class="hljs-property">@template</span>.render <span class="hljs-property">@virtualDomDefine</span>, scope, doneOrAsync


    <span class="hljs-attribute">mount</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@el</span>.appendChild <span class="hljs-property">@refs</span>


    <span class="hljs-attribute">set</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@template</span>.set.apply <span class="hljs-property">@template</span>, arguments <span class="hljs-keyword">if</span> <span class="hljs-property">@template</span>


    <span class="hljs-attribute">get</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@template</span>.get.apply <span class="hljs-property">@template</span>, arguments <span class="hljs-keyword">if</span> <span class="hljs-property">@template</span>


    <span class="hljs-attribute">remove</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@template</span>.remove.apply <span class="hljs-property">@template</span>, arguments <span class="hljs-keyword">if</span> <span class="hljs-property">@template</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>属性有更新</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">update</span>: <span class="hljs-function"><span class="hljs-params">(attrName, value)</span>-&gt;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-property">@get</span>(attrName) != value
            <span class="hljs-property">@set</span> attrName, value
            <span class="hljs-property">@emit</span> <span class="hljs-string">'update'</span>, attrName, value
            <span class="hljs-property">@emit</span> <span class="hljs-string">'change:'</span> + attrName, value</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>向 parent dom 发送自定义事件</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">emitEvent</span>: <span class="hljs-function"><span class="hljs-params">(eventName, args)</span>-&gt;</span>
        proxyEventName = <span class="hljs-property">@getProxyEventName</span> eventName
        parentView = <span class="hljs-property">@el</span>._element.template._proxy
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> !parentView

        <span class="hljs-keyword">if</span> util.isFunction parentView[proxyEventName]
            parentView[proxyEventName].apply parentView, args</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>取代理事件名</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">getProxyEventName</span>: <span class="hljs-function"><span class="hljs-params">(eventName)</span>-&gt;</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">if</span> !<span class="hljs-property">@virtualEl</span> <span class="hljs-keyword">or</span> !<span class="hljs-property">@virtualEl</span>.props
        <span class="hljs-property">@virtualEl</span>.props[<span class="hljs-string">'on-'</span> + eventName]



    <span class="hljs-attribute">destroy</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-property">@template</span>
            <span class="hljs-property">@template</span>.destroy()
            <span class="hljs-property">@template</span> = <span class="hljs-literal">null</span>

<span class="hljs-built_in">module</span>.exports = Component</div></div></div></div></body></html>