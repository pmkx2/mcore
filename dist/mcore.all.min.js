!function(){"use strict";var t="0.8.1",e=1;if(!Object.create)var n=function(){};var i=Array.prototype.slice,r={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(t){r.eventHandlers[t.guid][t.type]||(r.eventHandlers[t.guid][t.type]=[]),r.eventHandlers[t.guid][t.type].push({guid:t.guid,handler:t.handler,scope:t.scope,type:t.type})},addEventHandler:function(t,e,n){var i,s={};"string"==typeof t?(i=n||!1,s[t]=e):(i=e||!1,s=t);for(var u in s)for(var o=s[u],a=u.split(" "),l=0,h=a.length;h>l;l++){var c=a[l];r.addEvent.call(this,{guid:this._guid||this._.guid,handler:o,scope:i,type:c})}},addGuid:function(t,n){(!t._guid||n)&&(t._guid=e++,r.attributes[t._guid]={},r.eventHandlers[t._guid]={})},attr:function(t){return r.attributes[t]},clone:function(t){var e=r.typeOf(t);return"object"===e?r.extend({},t):"array"===e?t.slice(0):void 0},create:function(t){return Object.create?Object.create(t):(n.prototype=t,new n)},createSubclass:function(t,e){function n(){if(!(this instanceof n))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&r.addGuid(this,!0),u.apply(this,arguments)}t=t||{},e=e||!1;var i=t.superclass.prototype,u=t.hasOwnProperty("constructor")?t.constructor:function(){};e&&r.extend(i,s),n.prototype=r.create(i),n.prototype.constructor=n,r.extend(n,{extend:function(){return r.extendThis.apply(this,arguments)},parent:i,proto:function(){return r.extendThis.apply(this.prototype,arguments)},subclass:function(t){return t=t||{},t.superclass=this,r.createSubclass(t)}});for(var o in t)"constructor"!==o&&"superclass"!==o&&(n.prototype[o]=t[o]);return n},emitEvents:function(t,e,n,s){n=n||!1,s=s||this._guid;for(var u=i.call(r.eventHandlers[s][t]),o=0,a=u.length;a>o;o++){var l=r.extend({},u[o]),h=l.scope?l.scope:this;n&&(l.type=n),l.scope=h,l.handler.call(l.scope,e,l)}},extend:function(){for(var t=i.call(arguments),e=t.shift(),n=0,r=t.length;r>n;n++){var s=t[n];for(var u in s)e[u]=s[u]}return e},extendThis:function(){var t=i.call(arguments);return t.unshift(this),r.extend.apply(this,t)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},removeAttribute:function(t,e){e=e||!1;for(var n=r.trim(t).split(" "),i={},s=0,u=n.length;u>s;s++){var o=r.trim(n[s]);o&&(i.key=o,i.oldValue=r.attr(this._guid)[o],delete r.attr(this._guid)[o],e||(this.emit("change",o),this.emit("change:"+o),this.emit("mutate",i),this.emit("mutate:"+o,i),this.emit("remove",o),this.emit("remove:"+o)),delete i.oldValue)}},removeEventHandler:function(t,e){var n=r.eventHandlers[this._guid];if(t&&e){if(n=n[t],!n)return;for(var i,s=0,u=n.length;u>s;s++)i=n[s].handler,i&&i===e&&(n.splice(s--,1),u--)}else t?delete n[t]:r.eventHandlers[this._guid]={}},setAttribute:function(t,e,n){n=n||!1;var i=this.has(t),s=r.attr(this._guid)[t];if(e!==s&&(r.attr(this._guid)[t]=e,!n)){this.emit("change",t),this.emit("change:"+t,e);var u={key:t,newValue:e,oldValue:s||null};this.emit("mutate",u),this.emit("mutate:"+t,u);var o=i?"update":"create";this.emit(o,t),this.emit(o+":"+t,e)}},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(t){return null===t||"undefined"==typeof t?String(t):Object.prototype.toString.call(t).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(t,e,n){var i=this.get(t),s=r.typeOf(i);("object"===s||"array"===s)&&(i=r.clone(i));var u=e.call(this,i,t);r.setAttribute.call(this,t,u,n||!1)}},s={emit:function(t,e){e="undefined"==typeof e?null:e;for(var n=t.split(" "),i=0,s=n.length;s>i;i++){var u=n[i];r.eventHandlers[-1].all&&r.emitEvents.call(this,"all",e,u,-1),r.eventHandlers[-1][u]&&r.emitEvents.call(this,u,e,u,-1),"number"==typeof this._guid&&(r.eventHandlers[this._guid].all&&r.emitEvents.call(this,"all",e,u),r.eventHandlers[this._guid][u]&&r.emitEvents.call(this,u,e))}},off:function(){r.removeEventHandler.apply(this,arguments)},on:function(){r.addEventHandler.apply(this,arguments)}};r.Module=function(){},r.Module.prototype={each:function(t,e){var n=r.attr(this._guid);for(var i in n){var s=n[i];t.call(e||this,s,i)}},extend:function(){return r.extendThis.apply(this,arguments)},filter:function(t){var e=[],n=r.attr(this._guid);for(var i in n)t.call(this,n[i],i)&&e.push(n[i]);return e},get:function(t){if("string"==typeof t){if(arguments.length>1){for(var e={},n=0,i=arguments.length;i>n;n++){var s=arguments[n];e[s]=this.get(s)}return e}return this.has(t)?r.attr(this._guid)[t]:null}if("function"==typeof t){var u=this.filter(t);return u.length?u[0]:null}},getAll:function(){return r.clone(r.attr(this._guid))},getAllAsArray:function(){var t=[],e=r.attr(this._guid);for(var n in e){var i=e[n];"object"!==r.typeOf(i)||i.id||(i.id=n),t.push(i)}return t},has:function(t){return"undefined"!=typeof r.attr(this._guid)[t]},map:function(t,e){var n=[];return this.each(function(i,r){n.push(t.call(e||this,i,r))},e||this),n},push:function(t,e){if("array"===r.typeOf(t))for(var n=0,i=t.length;i>n;n++)r.setAttribute.call(this,r.makeUuid(),t[n],e||!1);else r.setAttribute.call(this,r.makeUuid(),t,e||!1);return this},remove:function(t,e){return"undefined"==typeof t?(r.attributes[this._guid]={},this.emit("change remove")):"function"==typeof t?this.each(function(n,i){t(n)&&r.removeAttribute.call(this,i,e)}):r.removeAttribute.call(this,t,e||!1),this},set:function(t,e,n){if("object"==typeof t)for(var i in t)r.setAttribute.call(this,i,t[i],e||!1);else r.setAttribute.call(this,t,e,n||!1);return this},size:function(){var t=0,e=r.attr(this._guid);for(var n in e)t++;return t},update:function(t,e,n){return"string"==typeof t?r.updateAttribute.call(this,t,e,n||!1):"function"==typeof t&&this.each(function(e,n){r.updateAttribute.call(this,n,t)}),this}};var u={_:r,extend:function(){return r.extendThis.apply(r.Module.prototype,arguments)},mixinEvents:function(t){return t=t||{},r.addGuid(t),r.extend(t,s)},on:function(){r.addEventHandler.apply(this,arguments)},subclass:function(t,e){return e=e||!1,t=t||{},t.superclass=e?function(){}:r.Module,r.createSubclass(t,!e)},version:t};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.Stapes=u):"function"==typeof define&&define.amd?define("stapes",function(){return u}):window.Stapes=u}(),function(){function t(t,n,i,r){return new e(t,n,i,r)}function e(t,e,i,r){this.options=r||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=i,this.objectPath=[],this.parse(),n(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function n(t){return"object"==typeof t&&null!==t}function i(t){throw new Error("[sightglass] "+t)}t.adapters={},e.tokenize=function(t,e,n){var i,r,s=[],u={i:n,path:""};for(i=0;i<t.length;i++)r=t.charAt(i),~e.indexOf(r)?(s.push(u),u={i:r,path:""}):u.path+=r;return s.push(u),s},e.prototype.parse=function(){var n,r,s=this.interfaces();s.length||i("Must define at least one adapter interface."),~s.indexOf(this.keypath[0])?(n=this.keypath[0],r=this.keypath.substr(1)):("undefined"==typeof(n=this.options.root||t.root)&&i("Must define a default root adapter."),r=this.keypath),this.tokens=e.tokenize(r,s,n),this.key=this.tokens.pop()},e.prototype.realize=function(){var t,e=this.obj,i=!1;return this.tokens.forEach(function(r,s){n(e)?("undefined"!=typeof this.objectPath[s]?e!==(t=this.objectPath[s])&&(this.set(!1,r,t,this.update.bind(this)),this.set(!0,r,e,this.update.bind(this)),this.objectPath[s]=e):(this.set(!0,r,e,this.update.bind(this)),this.objectPath[s]=e),e=this.get(r,e)):(i===!1&&(i=s),(t=this.objectPath[s])&&this.set(!1,r,t,this.update.bind(this)))},this),i!==!1&&this.objectPath.splice(i),e},e.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(n(this.target)&&this.set(!1,this.key,this.target,this.callback),n(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,this.value()!==e&&this.callback())},e.prototype.value=function(){return n(this.target)?this.get(this.key,this.target):void 0},e.prototype.setValue=function(t){n(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},e.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},e.prototype.set=function(t,e,n,i){var r=t?"observe":"unobserve";this.adapter(e)[r](n,e.path,i)},e.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(t.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},e.prototype.adapter=function(e){return this.options.adapters[e.i]||t.adapters[e.i]},e.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,n){(t=this.objectPath[n])&&this.set(!1,e,t,this.update.bind(this))},this),n(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define("sightglass",[],function(){return this.sightglass=t}):this.sightglass=t}.call(this),function(){var t,e,n,i,r=function(t,e){return function(){return t.apply(e,arguments)}},s=[].slice,u={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t={options:["prefix","templateDelimiters","rootInterface","preloadData","handler"],extensions:["binders","formatters","components","adapters"],"public":{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,n){return this.call(t,e,n.view.models)},configure:function(e){var n,i,r,s;null==e&&(e={});for(r in e)if(s=e[r],"binders"===r||"components"===r||"formatters"===r||"adapters"===r)for(i in s)n=s[i],t[r][i]=n;else t["public"][r]=s},bind:function(e,n,i){var r;return null==n&&(n={}),null==i&&(i={}),r=new t.View(e,n,i),r.bind(),r},init:function(e,n,i){var r,s;return null==i&&(i={}),null==n&&(n=document.createElement("div")),e=t["public"].components[e],n.innerHTML=e.template.call(this,n),r=e.initialize.call(this,n,i),s=new t.View(n,r),s.bind(),s}}},window.jQuery||window.$?(i="on"in jQuery.prototype?["on","off"]:["bind","unbind"],e=i[0],n=i[1],t.Util={bindEvent:function(t,n,i){return jQuery(t)[e](n,i)},unbindEvent:function(t,e,i){return jQuery(t)[n](e,i)},getInputValue:function(t){var e;return e=jQuery(t),"checkbox"===e.attr("type")?e.is(":checked"):e.val()}}):t.Util={bindEvent:function(){return"addEventListener"in window?function(t,e,n){return t.addEventListener(e,n,!1)}:function(t,e,n){return t.attachEvent("on"+e,n)}}(),unbindEvent:function(){return"removeEventListener"in window?function(t,e,n){return t.removeEventListener(e,n,!1)}:function(t,e,n){return t.detachEvent("on"+e,n)}}(),getInputValue:function(t){var e,n,i,r;if("checkbox"===t.type)return t.checked;if("select-multiple"===t.type){for(r=[],n=0,i=t.length;i>n;n++)e=t[n],e.selected&&r.push(e.value);return r}return t.value}},t.TypeParser=function(){function t(){}return t.types={primitive:0,keypath:1},t.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:isNaN(Number(t))===!1?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},t}(),t.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var n,i,r,s,u,o,a;for(o=[],s=t.length,n=0,i=0;s>i;){if(n=t.indexOf(e[0],i),0>n){o.push({type:this.types.text,value:t.slice(i)});break}if(n>0&&n>i&&o.push({type:this.types.text,value:t.slice(i,n)}),i=n+e[0].length,n=t.indexOf(e[1],i),0>n){u=t.slice(i-e[1].length),r=o[o.length-1],(null!=r?r.type:void 0)===this.types.text?r.value+=u:o.push({type:this.types.text,value:u});break}a=t.slice(i,n).trim(),o.push({type:this.types.binding,value:a}),i=n+e[1].length}return o},t}(),t.View=function(){function e(e,n,i){var s,u,o,a,l,h,c,p,f,d,v,b,m;for(this.els=e,this.models=n,null==i&&(i={}),this.update=r(this.update,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.select=r(this.select,this),this.traverse=r(this.traverse,this),this.build=r(this.build,this),this.buildBinding=r(this.buildBinding,this),this.bindingRegExp=r(this.bindingRegExp,this),this.options=r(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),f=t.extensions,l=0,c=f.length;c>l;l++){if(u=f[l],this[u]={},i[u]){d=i[u];for(s in d)o=d[s],this[u][s]=o}v=t["public"][u];for(s in v)o=v[s],null==(a=this[u])[s]&&(a[s]=o)}for(b=t.options,h=0,p=b.length;p>h;h++)u=b[h],this[u]=null!=(m=i[u])?m:t["public"][u];this.build()}return e.prototype.options=function(){var e,n,i,r,s;for(n={},s=t.extensions.concat(t.options),i=0,r=s.length;r>i;i++)e=s[i],n[e]=this[e];return n},e.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},e.prototype.buildBinding=function(e,n,i,r){var s,u,o,a,l,h,c;return l={},c=function(){var t,e,n,i;for(n=r.split("|"),i=[],t=0,e=n.length;e>t;t++)h=n[t],i.push(h.trim());return i}(),s=function(){var t,e,n,i;for(n=c.shift().split("<"),i=[],t=0,e=n.length;e>t;t++)u=n[t],i.push(u.trim());return i}(),a=s.shift(),l.formatters=c,(o=s.shift())&&(l.dependencies=o.split(/\s+/)),this.bindings.push(new t[e](this,n,i,a,l))},e.prototype.build=function(){var e,n,i,r,s;for(this.bindings=[],n=function(e){return function(i){var r,s,u,o,a,l,h,c,p,f,d,v,b,m;if(3===i.nodeType){if(a=t.TextTemplateParser,(u=e.templateDelimiters)&&(c=a.parse(i.data,u)).length&&(1!==c.length||c[0].type!==a.types.text)){for(p=0,d=c.length;d>p;p++)h=c[p],l=document.createTextNode(h.value),i.parentNode.insertBefore(l,i),1===h.type&&e.buildBinding("TextBinding",l,null,h.value);i.parentNode.removeChild(i)}}else 1===i.nodeType&&(r=e.traverse(i));if(!r){for(b=function(){var t,e,n,r;for(n=i.childNodes,r=[],t=0,e=n.length;e>t;t++)o=n[t],r.push(o);return r}(),m=[],f=0,v=b.length;v>f;f++)s=b[f],m.push(n(s));return m}}}(this),s=this.els,i=0,r=s.length;r>i;i++)e=s[i],n(e);this.bindings.sort(function(t,e){var n,i;return((null!=(n=e.binder)?n.priority:void 0)||0)-((null!=(i=t.binder)?i.priority:void 0)||0)})},e.prototype.traverse=function(e){var n,i,r,s,u,o,a,l,h,c,p,f,d,v,b,m;for(s=this.bindingRegExp(),u="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,v=e.attributes,c=0,f=v.length;f>c;c++)if(n=v[c],s.test(n.name)){if(l=n.name.replace(s,""),!(r=this.binders[l])){b=this.binders;for(o in b)h=b[o],"*"!==o&&-1!==o.indexOf("*")&&(a=new RegExp("^"+o.replace(/\*/g,".+")+"$"),a.test(l)&&(r=h))}r||(r=this.binders["*"]),r.block&&(u=!0,i=[n])}for(m=i||e.attributes,p=0,d=m.length;d>p;p++)n=m[p],s.test(n.name)&&(l=n.name.replace(s,""),this.buildBinding("Binding",e,l,n.value));return u||(l=e.nodeName.toLowerCase(),this.components[l]&&!e._bound&&(this.bindings.push(new t.ComponentBinding(this,e,l)),u=!0)),u},e.prototype.select=function(t){var e,n,i,r,s;for(r=this.bindings,s=[],n=0,i=r.length;i>n;n++)e=r[n],t(e)&&s.push(e);return s},e.prototype.bind=function(){var t,e,n,i,r;for(i=this.bindings,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.bind());return r},e.prototype.unbind=function(){var t,e,n,i,r;for(i=this.bindings,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.unbind());return r},e.prototype.sync=function(){var t,e,n,i,r;for(i=this.bindings,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push("function"==typeof t.sync?t.sync():void 0);return r},e.prototype.publish=function(){var t,e,n,i,r;for(i=this.select(function(t){var e;return null!=(e=t.binder)?e.publishes:void 0}),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.publish());return r},e.prototype.update=function(t){var e,n,i,r,s,u,o;null==t&&(t={});for(n in t)i=t[n],this.models[n]=i;for(u=this.bindings,o=[],r=0,s=u.length;s>r;r++)e=u[r],o.push("function"==typeof e.update?e.update(t):void 0);return o},e}(),t.Binding=function(){function e(t,e,n,i,s){this.view=t,this.el=e,this.type=n,this.keypath=i,this.options=null!=s?s:{},this.getValue=r(this.getValue,this),this.update=r(this.update,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.set=r(this.set,this),this.eventHandler=r(this.eventHandler,this),this.formattedValue=r(this.formattedValue,this),this.parseTarget=r(this.parseTarget,this),this.observe=r(this.observe,this),this.setBinder=r(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return e.prototype.setBinder=function(){var t,e,n,i;if(!(this.binder=this.view.binders[this.type])){i=this.view.binders;for(t in i)n=i[t],"*"!==t&&-1!==t.indexOf("*")&&(e=new RegExp("^"+t.replace(/\*/g,".+")+"$"),e.test(this.type)&&(this.binder=n,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},e.prototype.observe=function(e,n,i){return t.sightglass(e,n,i,{root:this.view.rootInterface,adapters:this.view.adapters})},e.prototype.parseTarget=function(){var e;return e=t.TypeParser.parse(this.keypath),0===e.type?this.value=e.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},e.prototype.formattedValue=function(e){var n,i,r,u,o,a,l,h,c,p,f,d,v,b;for(b=this.formatters,u=p=0,d=b.length;d>p;u=++p){for(o=b[u],r=o.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),a=r.shift(),o=this.view.formatters[a],r=function(){var e,n,s;for(s=[],e=0,n=r.length;n>e;e++)i=r[e],s.push(t.TypeParser.parse(i));return s}(),h=[],n=f=0,v=r.length;v>f;n=++f)i=r[n],h.push(0===i.type?i.value:((c=this.formatterObservers)[u]||(c[u]={}),(l=this.formatterObservers[u][n])?void 0:(l=this.observe(this.view.models,i.value,this.sync),this.formatterObservers[u][n]=l),l.value()));(null!=o?o.read:void 0)instanceof Function?e=o.read.apply(o,[e].concat(s.call(h))):o instanceof Function&&(e=o.apply(null,[e].concat(s.call(h))))}return e},e.prototype.eventHandler=function(t){var e,n;return n=(e=this).view.handler,function(i){return n.call(t,this,i,e)}},e.prototype.set=function(t){var e;return t=t instanceof Function&&!this.binder["function"]?this.formattedValue(t.call(this.model)):this.formattedValue(t),null!=(e=this.binder.routine)?e.call(this,this.el,t):void 0},e.prototype.sync=function(){var t,e;return this.set(function(){var n,i,r,s,u,o,a;if(this.observer){if(this.model!==this.observer.target){for(u=this.dependencies,n=0,r=u.length;r>n;n++)e=u[n],e.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(o=this.options.dependencies)?o.length:void 0))for(a=this.options.dependencies,i=0,s=a.length;s>i;i++)t=a[i],e=this.observe(this.model,t,this.sync),this.dependencies.push(e)}return this.observer.value()}return this.value}.call(this))},e.prototype.publish=function(){var t,e,n,i,r,u,o,a,l;if(this.observer){for(i=this.getValue(this.el),o=this.formatters.slice(0).reverse(),r=0,u=o.length;u>r;r++)e=o[r],t=e.split(/\s+/),n=t.shift(),(null!=(a=this.view.formatters[n])?a.publish:void 0)&&(i=(l=this.view.formatters[n]).publish.apply(l,[i].concat(s.call(t))));return this.observer.setValue(i)}},e.prototype.bind=function(){var t,e,n,i,r,s,u;if(this.parseTarget(),null!=(r=this.binder.bind)&&r.call(this,this.el),null!=this.model&&(null!=(s=this.options.dependencies)?s.length:void 0))for(u=this.options.dependencies,n=0,i=u.length;i>n;n++)t=u[n],e=this.observe(this.model,t,this.sync),this.dependencies.push(e);return this.view.preloadData?this.sync():void 0},e.prototype.unbind=function(){var t,e,n,i,r,s,u,o,a,l;for(null!=(u=this.binder.unbind)&&u.call(this,this.el),null!=(o=this.observer)&&o.unobserve(),a=this.dependencies,r=0,s=a.length;s>r;r++)i=a[r],i.unobserve();this.dependencies=[],l=this.formatterObservers;for(n in l){e=l[n];for(t in e)i=e[t],i.unobserve()}return this.formatterObservers={}},e.prototype.update=function(t){var e,n;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,null!=(n=this.binder.update)?n.call(this,t):void 0},e.prototype.getValue=function(e){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,e):t.Util.getInputValue(e)},e}(),t.ComponentBinding=function(e){function n(t,e,n){var i,s,u,o,l,h,c;for(this.view=t,this.el=e,this.type=n,this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.locals=r(this.locals,this),this.component=this.view.components[this.type],this["static"]={},this.observers={},this.upstreamObservers={},s=t.bindingRegExp(),h=this.el.attributes||[],o=0,l=h.length;l>o;o++)i=h[o],s.test(i.name)||(u=this.camelCase(i.name),a.call(null!=(c=this.component["static"])?c:[],u)>=0?this["static"][u]=i.value:this.observers[u]=i.value)}return o(n,e),n.prototype.sync=function(){},n.prototype.update=function(){},n.prototype.publish=function(){},n.prototype.locals=function(){var t,e,n,i,r,s;n={},r=this["static"];for(t in r)i=r[t],n[t]=i;s=this.observers;for(t in s)e=s[t],n[t]=e.value();return n},n.prototype.camelCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},n.prototype.bind=function(){var e,n,i,r,s,u,o,a,l,h,c,p,f,d,v,b,m,g,y,w,x;if(!this.bound){d=this.observers;for(n in d)i=d[n],this.observers[n]=this.observe(this.view.models,i,function(t){return function(e){return function(){return t.componentView.models[e]=t.observers[e].value()}}}(this).call(this,n));this.bound=!0}if(null!=this.componentView)return this.componentView.bind();for(this.el.innerHTML=this.component.template.call(this),o=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,u={},v=t.extensions,h=0,p=v.length;p>h;h++){if(s=v[h],u[s]={},this.component[s]){b=this.component[s];for(e in b)a=b[e],u[s][e]=a}m=this.view[s];for(e in m)a=m[e],null==(l=u[s])[e]&&(l[e]=a)}for(g=t.options,c=0,f=g.length;f>c;c++)s=g[c],u[s]=null!=(y=this.component[s])?y:this.view[s];this.componentView=new t.View(this.el,o,u),this.componentView.bind(),w=this.observers,x=[];for(n in w)r=w[n],x.push(this.upstreamObservers[n]=this.observe(this.componentView.models,n,function(t){return function(e,n){return function(){return n.setValue(t.componentView.models[e])}}}(this).call(this,n,r)));return x},n.prototype.unbind=function(){var t,e,n,i,r;n=this.upstreamObservers;for(t in n)e=n[t],e.unobserve();i=this.observers;for(t in i)e=i[t],e.unobserve();return null!=(r=this.componentView)?r.unbind.call(this):void 0},n}(t.Binding),t.TextBinding=function(t){function e(t,e,n,i,s){this.view=t,this.el=e,this.type=n,this.keypath=i,this.options=null!=s?s:{},this.sync=r(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return o(e,t),e.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},e.prototype.sync=function(){return e.__super__.sync.apply(this,arguments)},e}(t.Binding),t["public"].binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},t["public"].binders.html=function(t,e){return t.innerHTML=null!=e?e:""},t["public"].binders.show=function(t,e){return t.style.display=e?"":"none"},t["public"].binders.hide=function(t,e){return t.style.display=e?"none":""},t["public"].binders.enabled=function(t,e){return t.disabled=!e},t["public"].binders.disabled=function(t,e){return t.disabled=!!e},t["public"].binders.checked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var n;return"radio"===t.type?t.checked=(null!=(n=t.value)?n.toString():void 0)===(null!=e?e.toString():void 0):t.checked=!!e}},t["public"].binders.unchecked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var n;return"radio"===t.type?t.checked=(null!=(n=t.value)?n.toString():void 0)!==(null!=e?e.toString():void 0):t.checked=!e}},t["public"].binders.value={publishes:!0,priority:3e3,bind:function(e){return"INPUT"!==e.tagName||"radio"!==e.type?(this.event="SELECT"===e.tagName?"change":"input",t.Util.bindEvent(e,this.event,this.publish)):void 0},unbind:function(e){return"INPUT"!==e.tagName||"radio"!==e.type?t.Util.unbindEvent(e,this.event,this.publish):void 0},routine:function(t,e){var n,i,r,s,u,o,l;if("INPUT"===t.tagName&&"radio"===t.type)return t.setAttribute("value",e);if(null!=window.jQuery){if(t=jQuery(t),(null!=e?e.toString():void 0)!==(null!=(s=t.val())?s.toString():void 0))return t.val(null!=e?e:"")}else if("select-multiple"===t.type){if(null!=e){for(l=[],i=0,r=t.length;r>i;i++)n=t[i],l.push(n.selected=(u=n.value,a.call(e,u)>=0));return l}}else if((null!=e?e.toString():void 0)!==(null!=(o=t.value)?o.toString():void 0))return t.value=null!=e?e:""}},t["public"].binders["if"]={block:!0,priority:4e3,bind:function(t){var e,n;return null==this.marker?(e=[this.view.prefix,this.type].join("-").replace("--","-"),n=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+n+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)):void 0},unbind:function(){var t;return null!=(t=this.nested)?t.unbind():void 0},routine:function(e,n){var i,r,s,u;if(!!n==!this.bound){if(n){s={},u=this.view.models;for(i in u)r=u[i],s[i]=r;return(this.nested||(this.nested=new t.View(e,s,this.view.options()))).bind(),this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.bound=!0}return e.parentNode.removeChild(e),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},t["public"].binders.unless={block:!0,priority:4e3,bind:function(e){return t["public"].binders["if"].bind.call(this,e)},unbind:function(){return t["public"].binders["if"].unbind.call(this)},routine:function(e,n){return t["public"].binders["if"].routine.call(this,e,!n)},update:function(e){return t["public"].binders["if"].update.call(this,e)}},t["public"].binders["on-*"]={"function":!0,priority:1e3,unbind:function(e){return this.handler?t.Util.unbindEvent(e,this.args[0],this.handler):void 0},routine:function(e,n){return this.handler&&t.Util.unbindEvent(e,this.args[0],this.handler),t.Util.bindEvent(e,this.args[0],this.handler=this.eventHandler(n))}},t["public"].binders["each-*"]={block:!0,priority:4e3,bind:function(t){var e,n,i,r,s;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(s=this.iterated,i=0,r=s.length;r>i;i++)n=s[i],n.bind()},unbind:function(t){var e,n,i,r,s;if(null!=this.iterated){for(r=this.iterated,s=[],n=0,i=r.length;i>n;n++)e=r[n],s.push(e.unbind());return s}},routine:function(e,n){var i,r,s,u,o,a,l,h,c,p,f,d,v,b,m,g,y,w,x,k,N;if(l=this.args[0],n=n||[],this.iterated.length>n.length)for(w=Array(this.iterated.length-n.length),d=0,m=w.length;m>d;d++)s=w[d],f=this.iterated.pop(),f.unbind(),this.marker.parentNode.removeChild(f.els[0]);for(u=v=0,g=n.length;g>v;u=++v)if(a=n[u],r={index:u},r[l]=a,null==this.iterated[u]){x=this.view.models;for(o in x)a=x[o],null==r[o]&&(r[o]=a);c=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,h=this.view.options(),h.preloadData=!0,p=e.cloneNode(!0),f=new t.View(p,r,h),f.bind(),this.iterated.push(f),this.marker.parentNode.insertBefore(p,c.nextSibling)}else this.iterated[u].models[l]!==a&&this.iterated[u].update(r);if("OPTION"===e.nodeName){for(k=this.view.bindings,N=[],b=0,y=k.length;y>b;b++)i=k[b],i.el===this.marker.parentNode&&"value"===i.type?N.push(i.sync()):N.push(void 0);return N}},update:function(t){var e,n,i,r,s,u,o,a;e={};for(n in t)i=t[n],n!==this.args[0]&&(e[n]=i);for(o=this.iterated,a=[],s=0,u=o.length;u>s;s++)r=o[s],a.push(r.update(e));return a}},t["public"].binders["class-*"]=function(t,e){var n;return n=" "+t.className+" ",!e==(-1!==n.indexOf(" "+this.args[0]+" "))?t.className=e?""+t.className+" "+this.args[0]:n.replace(" "+this.args[0]+" "," ").trim():void 0},t["public"].binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},t["public"].adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e,n,i;return t.hasOwnProperty(this.id)||(e=this.counter++,Object.defineProperty(t,this.id,{value:e})),(n=this.weakmap)[i=t[this.id]]||(n[i]={callbacks:{}})},cleanupWeakReference:function(t,e){return Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length?void 0:delete this.weakmap[e]},stubFunction:function(t,e){var n,i,r;return i=t[e],n=this.weakReference(t),r=this.weakmap,t[e]=function(){var e,s,u,o,a,l,h,c,p,f;o=i.apply(t,arguments),h=n.pointers;for(u in h)for(s=h[u],f=null!=(c=null!=(p=r[u])?p.callbacks[s]:void 0)?c:[],a=0,l=f.length;l>a;a++)(e=f[a])();return o}},observeMutations:function(t,e,n){var i,r,s,u,o,l;if(Array.isArray(t)){if(s=this.weakReference(t),null==s.pointers)for(s.pointers={},r=["push","pop","shift","unshift","sort","reverse","splice"],o=0,l=r.length;l>o;o++)i=r[o],this.stubFunction(t,i);if(null==(u=s.pointers)[e]&&(u[e]=[]),a.call(s.pointers[e],n)<0)return s.pointers[e].push(n)}},unobserveMutations:function(t,e,n){var i,r,s;return Array.isArray(t)&&null!=t[this.id]&&(r=this.weakmap[t[this.id]])&&(s=r.pointers[e])?((i=s.indexOf(n))>=0&&s.splice(i,1),s.length||delete r.pointers[e],this.cleanupWeakReference(r,t[this.id])):void 0},observe:function(t,e,n){var i,r,s;return i=this.weakReference(t).callbacks,null==i[e]&&(i[e]=[],r=Object.getOwnPropertyDescriptor(t,e),(null!=r?r.get:void 0)||(null!=r?r.set:void 0)||(s=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return s},set:function(r){return function(u){var o,l,h,c;if(u!==s&&(r.unobserveMutations(s,t[r.id],e),s=u,o=r.weakmap[t[r.id]])){if(i=o.callbacks,i[e])for(c=i[e].slice(),l=0,h=c.length;h>l;l++)n=c[l],a.call(i[e],n)>=0&&n();return r.observeMutations(u,t[r.id],e)}}}(this)}))),a.call(i[e],n)<0&&i[e].push(n),this.observeMutations(t[e],t[this.id],e)},unobserve:function(t,e,n){var i,r,s;return(s=this.weakmap[t[this.id]])&&(i=s.callbacks[e])?((r=i.indexOf(n))>=0&&(i.splice(r,1),i.length||delete s.callbacks[e]),this.unobserveMutations(t[e],t[this.id],e),this.cleanupWeakReference(s,t[this.id])):void 0},get:function(t,e){return t[e]},set:function(t,e,n){return t[e]=n}},t.factory=function(e){return t.sightglass=e,t["public"]._=t,t["public"]},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=t.factory(require("sightglass")):"function"==typeof define&&define.amd?define("rivets",["sightglass"],function(e){return this.rivets=t.factory(e)}):this.rivets=t.factory(sightglass)}.call(this),define("mcore/route",["mcore/util"],function(t){"use strict";var e,n,i;return i=function(t,e,n,i){var r;return null==e&&(e=[]),null==n&&(n=!1),null==i&&(i=!1),t instanceof RegExp?t:(r=function(t,n,i,r,s,u){return e.push({name:r,optional:!!u}),n=n||"",""+(u&&""||n)+"(?:"+(u&&n||"")+(i||"")+(s||i&&"([^/.]+?)"||"([^/]+?)")+")"+(u||"")},t=t.concat(i&&""||"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,r).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n&&""||"i"))},n=function(e){var n,i,r,s,u;return e=String(e),n="",r=[],-1!==e.indexOf("?")?n=e.split("?").pop():-1!==e.indexOf("&")&&(n=e),""===n?{}:(i=n.split("&"),s={},u=[],i.forEach(function(e){var n,i;-1!==e.indexOf("=")&&(e=e.split("="),2===e.length&&(n=e[0].trim(),i=e[1],i=t.isNumber(i)?Number(i):decodeURIComponent(i),s[n]=i))}),s)},e=function(t,n,i){
this.hashchange=null!=t?t:e.changeByLocationHash,this.sensitive=null!=n?n:!1,this.strict=null!=i?i:!1,this.rule=[]},e.prototype.run=function(){this.hashchange(function(t){return function(e){t.match(e)}}(this))},e.prototype.add=function(t,e){var n,r;return n=[],r=i(t,n,this.sensitive,this.strict),this.rule.push({path:t,reg:r,keys:n,fn:e}),this},e.prototype.match=function(e){var i,r,s,u,o;return o=String(e),r=o,i="",s=o.indexOf("?"),-1===s&&(s=o.indexOf("&")),u=!1,-1!==s&&(i=o.substring(s),o=o.substring(0,s)),t.each(this.rule,function(e){var s,a,l,h,c,p,f,d,v,b;if(u)return!1;if(d=e.reg.exec(o),null!==d){for(u=!0,a=n(i),l={},s=[],c=p=1,v=d.length;v>=1?v>p:p>v;c=v>=1?++p:--p)f=e.keys[c-1],b=d[c],t.isNumber(b)?b=Number(b):b&&(b=decodeURIComponent(b)),f&&f.name&&(l[f.name]=b),s.push(b||null);h={url:r,path:o,args:i,rule:e.path,context:a,keys:e.keys,data:l},e.fn.apply(h,s)}}),this},e.changeByLocationHash=function(t){var e;return e=function(){return t(window.location.hash.substring(1))},window.addEventListener?window.addEventListener("hashchange",e,!1):window.attachEvent("onhashchange",e),e()},e.changeByHistory=function(t){var n;return window.history||e.changeByLocationHash(t),n=function(){return t(window.location.hash.substring(1))},window.onpopstate=function(t){return n()},n()},{pathToRegexp:i,pathToObject:n,Route:e}}),function(){var t=[].slice;define("mcore/template",["jquery","rivets","mcore/util","stapes"],function(e,n,i,r){"use strict";var s;return n.adapters[":"]={observe:function(t,e,n){t.on("change:"+e,n)},unobserve:function(t,e,n){t.off("change:"+e,n)},get:function(t,e){return t.get(e)},set:function(t,e,n){t.set(e,n)}},n.configure({rootInterface:".",handler:function(t,e,n){var i;return i=this.call(n.view.models.self,t,e),!1===i?e.stopPropagation&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):(window.event.cancelBubble=!0,window.event.returnValue=!1):void 0}}),n.formatters.nl2br=function(t){return t?String(t).trim().replace(/<[^>]+>/g,"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2"):""},n.formatters.link=function(t,e){return t?String(t)+String(e):""},n.formatters.and=function(t,e){return t?e:t},n.formatters.or=function(t,e){return t?t:e},n.formatters.slice=function(t,e,n){return Array.isArray(t)?[]:t.slice(e,n)},n.formatters.substr=function(t,e,n){return t?String(t).substring(e,n):""},n.formatters.len=function(t){return Array.isArray(t)?t.length:t?String(t).length:0},n.formatters.eq=function(t,e){return t===e},n.formatters["<"]=function(t,e){return Number(t)<Number(e)},n.formatters["<="]=function(t,e){return Number(t)<=Number(e)},n.formatters["=="]=function(t,e){return Number(t)===Number(e)},n.formatters[">="]=function(t,e){return Number(t)>=Number(e)},n.formatters[">"]=function(t,e){return Number(t)>Number(e)},n.formatters["+"]=function(t,e){return Number(t)+Number(e)},n.formatters["-"]=function(t,e){return Number(t)-Number(e)},n.formatters["*"]=function(t,e){return Number(t)*Number(e)},n.formatters["/"]=function(t,e){return Number(t)/Number(e)},n.formatters.isArray=function(t){return Array.isArray(t)},n.formatters.eachObject=function(t){var e,n,r,s;if(!1===i.isObject(t))return[];e=[],r=[];for(n in t)s=t[n],r.push(e.push({key:n,value:s}));return r},n.formatters.toFixed=function(t,e){return null==e&&(e=1),!1===i.isNumber(t)?0:Number(t).toFixed(e)},n.formatters["in"]=function(){var e,n;return e=1<=arguments.length?t.call(arguments,0):[],e.length<2?!1:(n=e[0],e.splice(0,1),i.isNumber(n)&&(n=Number(n)),-1!==e.indexOf(n))},s=function(t,i){var r,u,o;return this.view=t,null==i&&(i={}),u=Object.keys(i),this.rv=!1,r=e.Deferred(),0===u.length?(o=n.bind(this.view.$el,{self:this.view}),this.rv=o,r.resolve(o)):s.loadPromise(i).done(function(t){return function(e){u.forEach(function(n){var i;return i=e[n],null!=i?t.view.set(n,i):void 0}),o=n.bind(t.view.$el,{self:t.view}),t.rv=o,r.resolve(o)}}(this)).fail(function(){return r.reject("template render error")}),r.promise()},s.prototype.set=function(t,e){return e.then(function(e){return function(n){return e.view.set(t,n)}}(this))},s.prototype.update=function(t){var n,i;return null==t&&(t={}),n=e.Deferred(),!1===this.rv?n.reject("Template no init"):(i=Object.keys(t),s.loadPromise(t).done(function(t){return function(e){i.forEach(function(n){var i;return i=e[n],null!=i?t.view.set(n,i):void 0}),n.resolve}}(this)).fail(function(){return n.reject("template update error")})),n.promise()},s.prototype.destroy=function(){return this.rv?this.rv.unbind():void 0},s.loadPromise=function(n){var i,r,s;return i=e.Deferred(),r=Object.keys(n),0===r.length?i.resolve({}):(1===r.length?s=n[r[0]]:(s=[],r.forEach(function(t){return function(t){return s.push(n[t])}}(this))),e.when(s).done(function(){var e,n;return e=1<=arguments.length?t.call(arguments,0):[],n={},e.forEach(function(t){return function(t,e){var i;return i=r[e],i?n[i]=t:void 0}}(this)),i.resolve(n)}).fail(function(){return i.reject()})),i.promise()},s.loadTpl=function(t){var n,i;return n=e.Deferred(),i=t.split("/"),2===i.length?requirejs(["tpl/"+i[0]],function(t){var e;return e=t[i[1]],e?n.resolve(e):n.reject("url data map error")}):n.reject("uri error"),n.promise()},s.renderString=function(t,e,n){var i;return null==e&&(e={}),i=Object.keys(e),i.length>0&&!n.tpl&&i.forEach(function(t){return function(t){return n.set(t,null)}}(this)),n.tpl?n.tpl.update(e).then(function(){return n.emit("tplUpdate")}):(n.$el.append(t),n.tpl=new s(n,e),n.tpl.then(function(){return n.emit("render")}))},s.render=function(t,e,n){return null==e&&(e={}),s.loadTpl(t).then(function(t){return s.renderString(t,e,n)})},s.formatters=function(t,e){return n.formatters[t]=e},s.Attr=r.subclass({constructor:function(t,n,i){return this.name=t,this.rv=n,this.el=i,this.$el=e(this.el),this.init(this.el)},sync:function(t){return this.rv.observer.setValue(t)},init:function(t){},update:function(t,e){},destroy:function(t){}}),s.regAttr=function(t,e){var i;return i=null,n.binders[t]={bind:function(n){return i=new e(t,this,n)},unbind:function(t){return i.destroy(t)},routine:function(t,e){return i.update(e,t)}}},s.regTag=function(t,e){return null==e&&(e={}),n.components[t]={"static":e["static"]||[],attributes:e.attr||[],template:e.template||function(){return""},initialize:e.init||function(){}}},s})}.call(this),function(){define("mcore/ui",["jquery","mcore/template","stapes"],function(t,e,n){"use strict";return n.subclass({constructor:function(e,n){return this.options=null!=n?n:{},this.$el=t("<div/>"),this.$parent=e,this.on("render",function(t){return function(){return t.$el.appendTo(t.$parent)}}(this)),this.init(),this.watch()},destroy:function(){return this.tpl&&this.tpl.destroy(),this.$el.remove()},render:function(t,n){return null==n&&(n={}),e.render(t,n,this)},renderString:function(t,n){return null==n&&(n={}),e.renderString(t,n,this)},init:function(){},watch:function(){}})})}.call(this),function(){define("mcore/view",["jquery","mcore/template","stapes","mcore/util"],function(t,e,n,i){"use strict";var r,s,u,o;return s=t(window),r=t("body"),o=/MicroMessenger/i.test(window.navigator.userAgent),u=/iphone|ipad/gi.test(window.navigator.appVersion),n.subclass({constructor:function(t,e){return this.$el=t,this.app=e,this.$win=s,this.$body=r,this.util=i,this._cacheMap={},this.isWeixinBrowser=o,this.isIOS=u,this.tpl=!1,this.beforeInit(),this.init()},clone:function(t){return i.clone(t)},setTitle:function(e){var n;return this.title=e,document.title!==this.title?(document.title=this.title,this.isWeixinBrowser&&this.isIOS?(n=t('<iframe src="/favicon.ico"></iframe>'),n.one("load",function(){return setTimeout(function(){return n.remove()},0)}).appendTo(this.$body)):void 0):void 0},render:function(t,n){return null==n&&(n={}),e.render(t,n,this)},renderString:function(t,n){return null==n&&(n={}),e.renderString(t,n,this)},when:function(){return t.when.apply(this,arguments)},destroy:function(){return this.tpl&&this.tpl.destroy(),this.$el.remove()},cache:function(e,n,r){var s;return null==r&&(r={}),r=t.extend({storage:"session",time:1/0},r),s={session:this.promiseCacheSessionProxy,memory:i.promiseCacheMemoryproxy,localStorage:i.promiseCacheLocalProxy},r.proxy=s[r.time]||this.promiseCacheSessionProxy,i.promise.cache(e,n,r)},promiseCacheSessionProxy:function(){var t;return t={set:function(t,e){return this._cacheMap[t]=e},get:function(t){return this._cacheMap[t]||null}}},beforeInit:function(){},init:function(){},run:function(){},afterRun:function(){},watch:function(){}})})}.call(this),function(){define("mcore/util",function(){"use strict";var t,e,n,i,r;return r={},e=/^-{0,1}\d*\.{0,1}\d+$/,t="__cache_",n=window.localStorage,i={},r.isNumber=function(t){return e.test(t)},r.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},r.clone=function(t){return JSON.parse(JSON.stringify(t))},r.cache={set:function(e,i,r){var s;return null==r&&(r=1/0),r!==1/0&&(r=(new Date).getTime()+parseInt(r)),s={time:r,value:i},n.setItem(t+e,JSON.stringify(s))},get:function(e,i){var s,u;return null==i&&(i=null),(u=n.getItem(t+e))?(u=JSON.parse(u),s=(new Date).getTime(),s<=u.time?u.value:(r.cache.remove(e),i)):i},remove:function(e){return n.removeItem(t+e)}},r.promiseCache=function(t,e,n){var i,s;return i=n.proxy.get(t),i?(s=$.Deferred(),s.resolve(r.clone(i)),s.promise()):e.then(function(e){return n.proxy.set(t,r.clone(e),n.time)})},r.promiseCacheLocalProxy={set:r.cache.set,get:r.cache.get},r.promiseCacheMemoryproxy={set:function(t,e){return i[t]=e},get:function(t){return i[t]||null}},r.each=function(t,e){var n,i,r;if(null==e&&(e=function(){}),!1!==Array.isArray(t))for(n in t)if(r=t[n],i=e(r,n),!1===i)break},r})}.call(this),function(){define("mcore/app",["jquery","stapes","mcore/route"],function(t,e,n){"use strict";return e.subclass({constructor:function(e,i){this.$el=e,null==i&&(i={}),this.options=t.extend({viewClass:"mcore-app-view",routeChange:n.Route.changeByLocationHash},i),this.router=new n.Route(this.options.routeChange),this.curView=null},route:function(t,e){var n;return n=this,this.router.add(t,function(){return n.runView(e,this,arguments)}),this},runView:function(e,n,i){return this.curView&&(this.curView.name===e?(this.curView.instantiate.route=n,this.curView.instantiate.context=n.context,this.curView.instantiate.run.apply(this.curView.instantiate,i),this.emit("runView",this.curView)):(this.emit("destroyView",this.curView),this.curView.instantiate.destroy())),requirejs([e],function(r){return function(s){var u;return u=t("<div class='"+r.options.viewClass+"' />"),r.curView={name:e,instantiate:new s(u,r)},r.curView.instantiate.route=n,r.curView.instantiate.context=n.context,r.curView.instantiate.run.apply(r.curView.instantiate,i),r.curView.instantiate.$el.appendTo(r.$el),r.emit("runView",r.curView),r.curView.instantiate.afterRun()}}(this))},run:function(){return this.router.run()}})})}.call(this),function(){define("mcore",["mcore/util","mcore/template","mcore/view","mcore/route","mcore/ui","mcore/app"],function(t,e,n,i,r,s){"use strict";var u;return u={util:t,Template:e,View:n,Route:i,Ui:r,App:app}})}.call(this),define("formSerializer",["jquery"],function(t){"use strict";var e=function(t){function e(e,i){function r(t,e,n){return t[e]=n,t}function s(t,e){for(var i,s=t.match(n.key);void 0!==(i=s.pop());)if(n.push.test(i)){var o=u(t.replace(/\[\]$/,""));e=r([],o,e)}else n.fixed.test(i)?e=r([],i,e):n.named.test(i)&&(e=r({},i,e));return e}function u(t){return void 0===f[t]&&(f[t]=0),f[t]++}function o(e){switch(t('[name="'+e.name+'"]',i).attr("type")){case"checkbox":return"on"===e.value?!0:e.value;default:return e.value}}function a(t){if(!n.validate.test(t.name))return this;var i=s(t.name,o(t));return p=e.extend(!0,p,i),this}function l(t){if(!e.isArray(t))throw new Error("formSerializer.addPairs expects an Array");for(var n=0,i=t.length;i>n;n++)this.addPair(t[n]);return this}function h(){return p}function c(){return JSON.stringify(h())}var p={},f={};this.addPair=a,this.addPairs=l,this.serialize=h,this.serializeJSON=c}var n={validate:/^[a-z_][a-z0-9_]*(?:\[(?:\d*|[a-z0-9_]+)\])*$/i,key:/[a-z0-9_]+|(?=\[\])/gi,push:/^$/,fixed:/^\d+$/,named:/^[a-z0-9_]+$/i};return e.patterns=n,e.serializeObject=function(){return new e(t,this).addPairs(this.serializeArray()).serialize()},e.serializeJSON=function(){return new e(t,this).addPairs(this.serializeArray()).serializeJSON()},"undefined"!=typeof t.fn&&(t.fn.serializeObject=e.serializeObject,t.fn.serializeJSON=e.serializeJSON),e}(t);return e}),function(){var t=[].slice;define("mcore-attr/validator",["jquery","mcore/template","formSerializer"],function(e,n){"use strict";var i,r,s,u,o,a,l,h,c,p,f;return r=/^[A-Za-z]+$/,u=/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,s=/^([1-2]\d{3})([-\/.])?(1[0-2]|0?[1-9])([-\/.])?([1-2]\d|3[01]|0?[1-9])$/,a=/^1[3-9]\d{9}$/,l=/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,o=/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i,f=function(){var t,e,n,i,r,s,u,o,a,l;return u="((https?|s?ftp|irc[6s]?|git|afp|telnet|smb):\\/\\/)?",l="([a-z0-9]\\w*(\\:[\\S]+)?\\@)?",e="(?:localhost|(?:[a-z0-9]+(?:[-\\w]*[a-z0-9])?(?:\\.[a-z0-9][-\\w]*[a-z0-9])*)*\\.[a-z]{2,})",s="(:\\d{1,5})?",i="\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",t="(\\/\\S*)?",n=[u,l,e,s,t],r=[u,l,i,s,t],o=new RegExp("^"+n.join("")+"$","i"),a=new RegExp("^"+r.join("")+"$","i"),function(t){return o.test(t||a.test(t))}}(),h={required:"不能为空",isNumber:"只能是数字",isAlphabet:"只能是字母",minlength:function(t){return"最小 "+t+" 位字符"},maxlength:function(t){return"最多 "+t+" 位字符"},min:function(t){return"数值要大于 "+t},max:function(t){return"数值要小于 "+t},equals:"两次输入的值不相符",isEmail:"邮箱格式不正确",isInteger:"数值必须是整数",isDate:"日期格式不正确",isMobile:"手机格式不正确",isTel:"座机格式不正确",isIdentityCode:"身份证号格式错误"},p={required:function(t){return null==t&&(t=""),String(t).trim().length>0},isAlphabet:function(t){return r.test(t)},minlength:function(t,e){return e=Number(e),t=String(t).trim(),t.length>=e},maxlength:function(t,e){return e=Number(e),t=String(t).trim(),t.length<e},isNumber:function(t){return e.isNumeric(t)},isInteger:function(t){return Number(t)%1===0},min:function(t,e){return Number(t)>=Number(e)},max:function(t,e){return Number(t)<=Number(e)},equals:function(t,e){return String(t)===String(e)},isEmail:function(t){return u.test(t)},isDate:function(t){var e,n,i,r,u;return s.test(t)?!1:(r=s.exec(t),u=Number(r[1]),i=Number(r[3]-1),n=Number(r[5]),e=new Date(u,i,n),u===e.getFullYear()&&i===e.getMonth()&&n===e.getDate())},isMobile:function(t){return a.test(t)},isTel:function(t){return l.test(t)},isIdentityCode:function(t){var e,n,i,r,s,u,a,l,h,c;if(n={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},o.test(t))return!1;if(!n[t.substr(0,2)])return!1;if(18===t.length){for(i=t.split(""),r=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],l=[1,0,"X",9,8,7,6,5,4,3,2],h=0,e=0,c=0,s=u=0;17>u;s=++u)e=i[s],c=r[s],h+=e*c;if(a=l[h%11],a!==i[17])return!1}return!0},isUrl:function(t){return f(t)}},i=n.Attr.subclass({constructor:n.Attr.prototype.constructor,init:function(){return this.$el.is("form")===!1?!1:this.$el.data("check",function(t){return function(){return t.initRules(),t.check()}}(this))},update:function(t){return this.$el.is("form")?void 0:t?this.$el.attr("validator",t):this.$el.removeAttr("validator")},check:function(){var t,n,i,r;return r=!0,n=this.$el.serializeObject(),i=null,t=this.$el,e.each(this.rules,function(e,s){var u;if("required"===s.type||""!==n[s.name]&&void 0!==n[s.name])return u=s.args[0],s.args[0]=n[s.name],!1===s.rule.apply(null,s.args)?(i=function(){return{$el:u,err:s.err,$form:t}},r=!1,!1):void 0}),r&&n||i},initRules:function(){var t;return t=this,this.rules=[],this.$validators=this.$el.find("[validator]"),this.$validators.each(function(){return t.parseValidator(e(this))})},parseValidator:function(t){var n;return(n=t.attr("name"))?t.attr("validator").split("|").forEach(function(i){return function(r){var s,u,o,a,l,c;return s=r.split(" ").filter(function(t){return e.trim(t).length>0}),c=s[0],(u=p[c])?(l=String(s[s.length-1]).trim(),o=h[c]||"出错了",a=l.indexOf("err:"),0===a&&(o=l.substring(4)),e.isFunction(o)&&(o=o.apply(null,s.slice(1))),s[0]=t,"equals"===c&&(s[1]=i.$el.find(s[1]).eq(0)),i.rules.push({name:n,type:c,rule:u,args:s,err:o})):void console.log("validator rule: "+c+" undefined")}}(this)):void 0}}),n.regAttr("validator",i),c={add:function(t,e){return p[t]=e},check:function(){var e,n;return e=1<=arguments.length?t.call(arguments,0):[],e.length<2?!1:(n=e[0],e.splice(0,1),p[n]?p[n].apply(null,e):!1)},addErrMsg:function(t,e){return h[t]=e},ValidatorAttr:i}})}.call(this);
//# sourceMappingURL=mcore.all.min.js.map